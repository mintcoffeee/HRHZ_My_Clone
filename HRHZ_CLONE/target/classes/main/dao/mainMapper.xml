<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mainSQL">

    <select id="getBestProductList"  resultType="java.util.HashMap">
       SELECT 
       		ROWNUM AS "row"
       	,	p.code AS "productCode"
       	,	p.name AS "productName"
       	,   (P.brand_code || '/' || pi.img_origin_name ) as "imgPath"
       	,   P.brand_code as "brandCode"
       	,   pi.img_origin_name as "imgOriginName"
       	,	(SELECT name FROM brand WHERE  code = p.brand_code) as "brandName"
       	,  	TO_CHAR( p.price  , '999,999,999,999,999') AS "price" 
       	,	p.like_count AS "like"
		FROM   product p
       	INNER JOIN (SELECT a.product_code
       					  , a.img_origin_name	
                          , MIN(a.seq)
                   	FROM   product_image a
                   	WHERE  a.thumbanil_yn = 'Y'
                   	GROUP  BY a.product_code
                   			, a.img_origin_name) pi
        ON p.code = pi.product_code
		WHERE  
			1 = 1
       	AND ROWNUM <![CDATA[<]]> 4
		ORDER  BY p.like_count DESC 
    </select>

</mapper>